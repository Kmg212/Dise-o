---
title: "Manejo básico de R"
subtitle: "Aplicación en el contexto agronómico"
author: "Kenedith Méndez - Gutiérrez"
format: 
  html:
    toc: true
    toc-expand: true
    code-fold: show
    toc-location: left
    toc-title: "Tabla de contenido"
    highlight-style: ayu-mirage
    theme: styles2.scss
    number-sections: true
    code-copy: true
knitr:
  opts_chunk:
    echo: true          
    eval: true          
    warning: false      
    message: false      
    fig.align: "center"
    fig.height: 6
    fig.width: 6.5 
editor: visual
---

# Introducción.

## ¿Qué es R?

R es un lenguaje de programación y un entorno de software para el análisis estadístico y la visualización de datos ampliamente utilizado en la investigación y en la industria.

## ¿Partes de la Interfaz de RStudio?

RStudio es un entorno de desarrollo integrado (IDE) para R. Su interfaz se divide en varias partes principales:

![Interfaz de RStudio tomada de (Capítulo 1 R Básico, n.d.)](https://arcruz0.github.io/libroadp/00-images/basic-r/rstudio.png){fig-align="center" width="824"}

## ¿Cómo crear documentos [`.qmd`]{style="color:orange;"} en R?

1.  Abrir RStudio

2.  Ir a "File" \> "New File" \> "Quarto Document".

3.  Identificar el documento.

4.  Elegir el tipo de documento y dar clic en "Create".

5.  Construye el documento.

6.  Guardar y renderizar.

    ::: callout-caution
    ## Información adicional

    1.  Recuerde que debe instalar previamente tanto R (Ir: <https://cran.r-project.org/bin/windows/base/>) como RStudio (Ir: <https://posit.co/downloads/>).
    2.  Para profundizar Ir a: [Tutorial: Hello, Quarto](https://quarto.org/docs/get-started/hello/rstudio.html)
    :::

# Paso a paso - práctica dirigida.

## Objetivo.

Proporcionar una comprensión integral de las herramientas y funciones básicas del entorno de R y RStudio para la estadística descriptiva con el fin de que los estudiantes desarrollen habilidades que le permitan:

-   Realizar operaciones básicas en R, incluyendo la manipulación y el análisis de datos.
-   Crear y personalizar tablas de resumen descriptivo para explorar y presentar datos.
-   Generar gráficos descriptivos (histogramas, diagramas de caja, gráficos de dispersión, etc.) para visualizar patrones y distribuciones en los datos.

## Contexto de los datos.

**datos_agro.xlsx**: Este conjunto de datos corresponde a la simulación de la información recolectada diariamente a lo largo de 100 días en una serie de parcelas agronómicas. Los datos incluyen variables clave para el análisis de rendimiento y condiciones ambientales en un contexto agrícola.

**Variables**

-   Fecha: Fechas de registro.
-   Rendimiento: Rendimiento (ton/ha)
-   Fertilización: Nivel de fertilización utilizado, categorizado como Bajo, Medio o Alto.
-   Precipitacion: Precipitación (mm)
-   Temperatura: Temperatura promedio (°C)
-   Variedad: Variedad de cultivo utilizada, con opciones A, B y C.
-   Insecticida: Indicador de si se utilizó insecticida o no.

## Introducción al R.

### Instalación de librerías.

```{r, eval=FALSE}
# Para manipulación de datos y gráficos
install.packages("tidyverse") 
# Para resúmenes descriptivos
install.packages("descriptr") 
# Para importar datos desde excel.
install.packages("readxl")
# Para gráficos.
install.packages("ggplot2")
# Para salidas de tablas.
install.packages("kableExtra")
```

### Cargar librerías.

```{r}
library(tidyverse)
library(descriptr)
library(readxl)
library(ggplot2)
library(kableExtra)
```

### Importar datos desde Excel

```{r}
#1. Definir el directorio de trabajo.
setwd("D:/Unimagdalena cursos/2024/2024II/Agro_DExperimental")
#2. Leer datos desde Excel.
datos <- read_excel("datos_agro.xlsx")
head(datos)
```

### Revisar la estructura de los datos.

```{r}
str(datos)
```

### Ajustar la naturaleza de las variables.

Cambiaremos la naturaleza de las variables cualitativas ó factor para que aparezcan como tal y bajo esa naturaleza las entienda el programa.

```{r}
datos$Fertilización<-as.factor(datos$Fertilización)
datos$Variedad<-as.factor(datos$Variedad)
datos$Insecticida<-as.factor(datos$Insecticida)
str(datos)
```

### Cambiar el orden de las categorías de una variable factor.

```{r}
datos$Fertilización<-factor(x = datos$Fertilización,levels = c("Bajo","Medio","Alto"))
```

## Estadística descriptiva.

### Generar resúmenes numéricos con el paquete [`descriptr`]{.orange}.

#### Para las variables numéricas.

```{r}
ds_tidy_stats(data = datos)%>% 
  kable(format ="html",digits = 2) %>% 
  kable_classic(font_size = 16)
```

#### Para una variable numérica por una variable factor ó cualitativa.

```{r}
ds_group_summary_interact(data = datos,  Rendimiento,Variedad)
```

#### Para una variable numérica por varias variables factor ó cualitativas.

```{r}
ds_group_summary_interact(data = datos,  Rendimiento,Variedad,Fertilización)
```

### Crear tablas con el paquete `descriptr`.

#### Tablas para variables cuantitativas continuas.

::: callout-caution
## Recuerde.

1.  La variables cuantitativas continuas se organizan en tablas agrupadas por intervalos.
2.  Para calcular el numéro de intervalos se utiliza la regla de sturges, $k=1+3.322*log10(n)$ redondeado al entero más cercano.
:::

```{r}
#1. Definina la cantidad de intervalos.
1+3.322*log10(100)

# 2. Construya la tabla.
tbl<-ds_freq_table(data = datos, variable = Rendimiento, bins = 8)
tbl$freq_data %>% kable(format ="html",digits = 2) %>% 
  kable_classic(font_size = 20)
```

#### Para variables factor ó cualitativas.

```{r}
ds_freq_table(data = datos, variable = Variedad)
```

#### Para dos variables factor ó cualitativas.

```{r, echo=TRUE}
ds_cross_table(data = datos,var1 = Variedad,var2 = Insecticida)
```

### Realizar gráficos con el paquete [`ggplot2`]{style="color:orange;"}.

#### Histogramas.

```{r, fig.height=4.7}
ggplot(data = datos,aes(x = Temperatura))+
  geom_histogram(bins = 8, fill="#a7c957",color="black")+
stat_bin(aes(label=..count..),geom="text", bins=8,vjust=-0.5)+ 
  theme_bw()+ labs(y="Cantidad de días (N°)", x="Temperatura (°C)")
```

#### Cajas y bigotes o boxplots.

```{r, fig.height=4.3}
ggplot(data = datos,aes(x = Variedad,y = Rendimiento))+
  stat_boxplot(geom='errorbar', linetype=1, width=0.1)+
  geom_boxplot(fill="#a7c957",color="black")+
  stat_summary(fun=mean, geom="point", size=3, shape=4)+
  theme_bw()+ labs(y="Rendimiento (ton/ha)",x="Variedad")
```

#### De promedios con barras de error.

```{r, fig.height=4.3}
ggplot(data = datos,aes(x = interaction(Fertilización, Variedad),y = Rendimiento))+
  geom_bar(fun=mean, stat = "summary", fill="#a7c957", color="black",width=0.6)+
  stat_summary(fun = mean, width=0.1,geom = "errorbar",
             fun.max = function(x) mean(x) + sd(x)/sqrt(length(x)), fun.min = function(x) mean(x) - sd(x)/sqrt(length(x)))+
  theme_bw()+ labs(y="Rendimiento (ton/ha)",x="Nivel de fertilización:Variedad")
```

#### Dispersión

```{r, fig.height=4.3}
ggplot(data = datos,aes(x = Temperatura,y = Rendimiento,fill=Variedad, color=Variedad))+
  geom_point(size=3)+
  geom_smooth(se = FALSE,method = "lm")+
  theme_bw()+ labs(y="Rendimiento (ton/ha)",x="Variedad")
```

# Actividades de práctica:

## Objetivo.

Aplicar técnicas de estadística descriptiva en R para analizar la influencia de diferentes variables sobre el rendimiento de maíz, de tal manera que estudiante pueda identificar patrones y relaciones entre las variables, que le permitan interpretar los resultados en un contexto agronómico

## Contexto de los datos.

Conjunto de datos bajo el nombre de **Maiz_ERArgentina.xlsx** contiene información sobre el rendimiento de maíz en la provincia Entre Ríos - Argentina. Las variables son:

1.  **Año**: Año desde el 2000 al 2023.

2.  **Rendimiento (ton/ha)**: Cantidad de maíz producido por hectárea.

3.  **Fecha de siembra**: Fecha en la que se realizó la siembra del maíz.

4.  **Fecha de cosecha**: Fecha en la que se cosechó el maíz.

5.  **Tipo de Suelo**: Clasificación del suelo (ej. franco-arenoso, arcilloso).

6.  **Nitrógeno (kg/ha)**: Cantidad de fertilizante nitrogenado aplicado.

7.  **Riego (mm)**: Cantidad de agua aplicada a través del riego.

8.  **Plagas y Enfermedades**: Presencia de plagas o enfermedades (sí/no).

9.  **Cultivo Anterior**: Cultivo anterior en la rotación.

## Pautas para la práctica en clase.

1.  Descargue el conjunto de datos.

2.  Abra el programa y cree un documento .qmd en formato word.

3.  Cargue las librerías necesarias.

4.  Importe los datos y haga los ajustes requeridos para los análisis.

5.  Cree una tabla de frecuencia para la variable riesgo.

6.  Cree una tabla de frecuencia para la variable presencia de plagas y/o enfermedades.

7.  Describa numéricamente las variables de manera general.

8.  Realice un gráfico comparativo del rendimiento por cultivo de rotación.

9.  Realice un gráfico que evalué la relación entre la cantidad de nitrógeno aplicado y el rendimiento.

## Pautas para la práctica en casa

1.  Descargue el conjunto de datos.

2.  Cree una columna que se llame \<\<Duración\>\> que corresponda a los días de duración del cultivo.

3.  Abra el programa y cree un documento .qmd en formato word.

4.  Cargue las librerías necesarias.

5.  Importe los datos y haga los ajustes requeridos para los análisis.

6.  Cree una tabla de frecuencia usando tanto la variable tipo de suelo como cultivo de rotación.

7.  Describa numéricamente las variables por presencia de plagas y/o enfermedades.

8.  Realice un gráfico comparativo del rendimiento total por año.

9.  Realice un histograma de la variable duración

10. Redacte un párrafo de análisis para los resultados del punto 6 al 9.
